{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://document-builder.internal/schemas/content-intent-package/v1.1",
  "title": "Content-Intent Package (CIP)",
  "description": "Schema for the Content-Intent Package exchanged between Content Intake Service and Gestalt Design Engine",
  "type": "object",
  "required": ["schema_version", "session_id", "submission_id", "content", "design_intent"],
  "properties": {
    "schema_version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+$",
      "description": "Semantic version of the CIP schema",
      "example": "1.1"
    },
    "session_id": {
      "type": "string",
      "pattern": "^sess-[a-zA-Z0-9\\-]+$",
      "description": "Unique session identifier from Content Intake Service",
      "example": "sess-12345"
    },
    "submission_id": {
      "type": "string",
      "pattern": "^subm-[0-9T:\\-Z]+$",
      "description": "Timestamp-based submission identifier",
      "example": "subm-2025-11-09T08:45:00Z"
    },
    "content": {
      "type": "object",
      "required": ["blocks"],
      "properties": {
        "blocks": {
          "type": "array",
          "minItems": 1,
          "maxItems": 1000,
          "items": {
            "$ref": "#/definitions/ContentBlock"
          }
        },
        "images": {
          "type": "array",
          "maxItems": 200,
          "items": {
            "$ref": "#/definitions/ImageAsset"
          },
          "default": []
        }
      }
    },
    "design_intent": {
      "type": "object",
      "required": ["purpose", "audience"],
      "properties": {
        "purpose": {
          "type": "string",
          "enum": ["report", "presentation", "proposal", "playbook"],
          "description": "Primary document purpose"
        },
        "audience": {
          "type": "string",
          "enum": ["executive", "technical", "customer", "internal"],
          "description": "Target audience type"
        },
        "tone": {
          "type": "string",
          "enum": ["formal", "conversational", "persuasive", "educational"],
          "default": "formal"
        },
        "goals": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["clarity", "impact", "brevity", "detail", "engagement"]
          },
          "default": ["clarity"]
        },
        "primary_actions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Intended reader actions",
          "default": []
        },
        "success_metrics": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Success measurement criteria",
          "default": []
        }
      }
    },
    "constraints": {
      "type": "object",
      "properties": {
        "visual_density": {
          "type": "string",
          "enum": ["tight", "balanced", "airy"],
          "default": "balanced"
        },
        "color_policy": {
          "type": "object",
          "properties": {
            "primary": {
              "type": "string",
              "pattern": "^#[0-9A-Fa-f]{6}$",
              "description": "Primary brand color in hex format"
            },
            "secondary": {
              "type": "string",
              "pattern": "^#[0-9A-Fa-f]{6}$"
            },
            "contrast_requirement": {
              "type": "number",
              "minimum": 3.0,
              "maximum": 21.0,
              "default": 4.5,
              "description": "WCAG contrast ratio requirement"
            }
          }
        },
        "brand_guidelines": {
          "type": "object",
          "properties": {
            "ref": {
              "type": "string",
              "description": "Reference to stored brand pack"
            }
          }
        },
        "document_preferences": {
          "type": "object",
          "properties": {
            "columns": {
              "type": "integer",
              "minimum": 1,
              "maximum": 3,
              "default": 1
            },
            "heading_style": {
              "type": "string",
              "enum": ["numbered", "plain", "decorative"],
              "default": "plain"
            }
          }
        },
        "presentation_preferences": {
          "type": "object",
          "properties": {
            "slide_count_target": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100
            },
            "aspect_ratio": {
              "type": "string",
              "enum": ["16:9", "4:3"],
              "default": "16:9"
            },
            "animation_allowed": {
              "type": "boolean",
              "default": false
            }
          }
        }
      },
      "default": {}
    },
    "metadata": {
      "type": "object",
      "properties": {
        "initiated_by": {
          "type": "string",
          "description": "User or automation identifier"
        },
        "submitted_at": {
          "type": "string",
          "format": "date-time"
        },
        "source_system": {
          "type": "string",
          "enum": ["web_app", "cli", "api", "automation"],
          "default": "api"
        },
        "trace_id": {
          "type": "string",
          "description": "Distributed tracing correlation ID"
        }
      },
      "default": {}
    }
  },
  "definitions": {
    "ContentBlock": {
      "type": "object",
      "required": ["block_id", "type", "sequence", "text"],
      "properties": {
        "block_id": {
          "type": "string",
          "description": "Stable unique identifier for this content block"
        },
        "type": {
          "type": "string",
          "enum": ["heading", "paragraph", "list", "quote", "table", "callout"]
        },
        "level": {
          "type": "integer",
          "minimum": 0,
          "maximum": 6,
          "default": 0,
          "description": "Heading level or list depth"
        },
        "sequence": {
          "type": "integer",
          "minimum": 0,
          "description": "Document order position"
        },
        "text": {
          "type": "string",
          "maxLength": 10000,
          "description": "UTF-8 text content"
        },
        "language": {
          "type": "string",
          "pattern": "^[a-z]{2}$",
          "default": "en",
          "description": "ISO 639-1 language code"
        },
        "detected_role": {
          "type": "string",
          "enum": ["introduction", "analysis", "summary", "action", "data", "supporting"],
          "description": "Semantic role within document"
        },
        "metrics": {
          "type": "object",
          "properties": {
            "word_count": {
              "type": "integer",
              "minimum": 0
            },
            "estimated_reading_seconds": {
              "type": "integer",
              "minimum": 0
            }
          }
        }
      }
    },
    "ImageAsset": {
      "type": "object",
      "required": ["image_id", "uri", "format", "width_px", "height_px", "alt_text"],
      "properties": {
        "image_id": {
          "type": "string",
          "description": "Unique image identifier"
        },
        "uri": {
          "type": "string",
          "format": "uri",
          "description": "Secure storage reference"
        },
        "format": {
          "type": "string",
          "enum": ["png", "jpg", "jpeg", "svg"]
        },
        "width_px": {
          "type": "integer",
          "minimum": 1,
          "maximum": 4096
        },
        "height_px": {
          "type": "integer",
          "minimum": 1,
          "maximum": 4096
        },
        "alt_text": {
          "type": "string",
          "maxLength": 500,
          "description": "Accessibility description"
        },
        "content_role": {
          "type": "string",
          "enum": ["illustration", "data", "process", "hero", "decorative"],
          "default": "illustration"
        },
        "dominant_palette": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^#[0-9A-Fa-f]{6}$"
          },
          "maxItems": 5,
          "description": "Dominant colors extracted from image"
        }
      }
    }
  }
}
